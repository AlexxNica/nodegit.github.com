<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Nodegit: Source: diff_list.js</title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/common.css">
    <link type="text/css" rel="stylesheet" href="styles/ir_black.css">
</head>

<body>

<div id="main">
    <!-- Fork Me -->
    <a href="http://github.com/tbranyen/nodegit">
      <img class="forkme"
      src="http://s3.amazonaws.com/github/ribbons/forkme_left_gray_6d6d6d.png"
      alt="Fork me on GitHub">
    </a>

    <div id="container">

        <!-- Branding -->
        <section class="branding">
            <a class="download" href="http://github.com/tbranyen/nodegit/zipball/master">
                <img src="http://github.com/images/modules/download/zip.png">
            </a>
            <a class="download" href="http://github.com/tbranyen/nodegit/tarball/master">
                <img src="http://github.com/images/modules/download/tar.png">
            </a>
            <div class="headline">
                <a href="http://github.com/tbranyen/nodegit">nodegit</a>
                <a class="travis" href="https://travis-ci.org/tbranyen/nodegit"><img src="https://travis-ci.org/tbranyen/nodegit.png" alt="Build Status" style="max-width:100%;"></a>
            </div>
            <span class="small">by <a href="http://github.com/tbranyen">tbranyen</a> &amp; <a href="http://github.com/faceleg">faceleg</a></span>
        </section>
        <div class="social">
            <iframe src="http://ghbtns.com/github-btn.html?count=true&user=tbranyen&repo=nodegit&type=watch" allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://nodegit.github.com/" data-text="When I need git tools in Node.js, I use nodegit" data-hashtags="nodejs">Tweet</a>
        </div>

        


    
    <section>
        <article>
            <pre><code>var git = require('../'),
    events = require('events');

/**
 * Convenience diff list class.
 *
 * @constructor
 * @param {git.raw.Repo} rawRepo
 * @param {git.raw.DiffList} [rawDiffList = new git.raw.DiffList]  
 */
var DiffList = function(rawRepo, rawDiffList) {
  if (!(rawRepo instanceof git.raw.Repo)) {
    throw new git.error('First parameter for DiffList must be a raw repo');
  }
  this.rawRepo = rawRepo;

  if (rawDiffList instanceof git.raw.DiffList) {
    this.rawDiffList = rawDiffList;
  } else {
    this.rawDiffList = new git.raw.DiffList();
  }
};

/**
 * Refer to vendor/libgit2/include/git2/diff.h for delta type definitions.
 *
 * @readonly
 * @enum {Integer}
 */
DiffList.prototype.deltaTypes = {
  /** 0 */ GIT_DELTA_UNMODIFIED: git.raw.DiffList.deltaTypes.GIT_DELTA_UNMODIFIED,
  /** 1 */ GIT_DELTA_ADDED: git.raw.DiffList.deltaTypes.GIT_DELTA_ADDED,
  /** 2 */ GIT_DELTA_DELETED: git.raw.DiffList.deltaTypes.GIT_DELTA_DELETED,
  /** 3 */ GIT_DELTA_MODIFIED: git.raw.DiffList.deltaTypes.GIT_DELTA_MODIFIED,
  /** 4 */ GIT_DELTA_RENAMED: git.raw.DiffList.deltaTypes.GIT_DELTA_RENAMED,
  /** 5 */ GIT_DELTA_COPIED: git.raw.DiffList.deltaTypes.GIT_DELTA_COPIED,
  /** 6 */ GIT_DELTA_IGNORED: git.raw.DiffList.deltaTypes.GIT_DELTA_IGNORED,
  /** 7 */ GIT_DELTA_UNTRACKED: git.raw.DiffList.deltaTypes.GIT_DELTA_UNTRACKED,
  /** 8 */ GIT_DELTA_TYPECHANGE: git.raw.DiffList.deltaTypes.GIT_DELTA_TYPECHANGE 
};

/**
 * Refer to vendor/libgit2/include/git2/diff.h for line origin type definitions.
 *
 * @readOnly
 * @enum {String}
 */
DiffList.prototype.lineOriginTypes = {
 /** ' '  */ GIT_DIFF_LINE_CONTEXT: git.raw.DiffList.lineOriginTypes.GIT_DIFF_LINE_CONTEXT,
 /** '+'  */ GIT_DIFF_LINE_ADDITION: git.raw.DiffList.lineOriginTypes.GIT_DIFF_LINE_ADDITION,
 /** '-'  */ GIT_DIFF_LINE_DELETION: git.raw.DiffList.lineOriginTypes.GIT_DIFF_LINE_DELETION,
 /** '\n' */ GIT_DIFF_LINE_ADD_EOFNL: git.raw.DiffList.lineOriginTypes.GIT_DIFF_LINE_ADD_EOFNL,
 /** ''   */ GIT_DIFF_LINE_DEL_EOFNL: git.raw.DiffList.lineOriginTypes.GIT_DIFF_LINE_DEL_EOFNL,
 /** 'F'  */ GIT_DIFF_LINE_FILE_HDR: git.raw.DiffList.lineOriginTypes.GIT_DIFF_LINE_FILE_HDR,
 /** 'H'  */ GIT_DIFF_LINE_HUNK_HDR: git.raw.DiffList.lineOriginTypes.GIT_DIFF_LINE_HUNK_HDR,
 /** 'B'  */ GIT_DIFF_LINE_BINARY: git.raw.DiffList.lineOriginTypes.GIT_DIFF_LINE_BINARY
};

/**
 * Walk the current diff list tree.
 *
 * @fires DiffList#delta
 * @fires DiffList#end
 * 
 * @return {EventEmitter} diffListWalkEmitter
 */
DiffList.prototype.walk = function() {
  var event = new events.EventEmitter(),
      allFileDeltas = [],
      self = this;
  
  self.rawDiffList.walk(function fileCallback(error, fileDeltas) {
    if (error) {
      event.emit('end', new git.error(error.message, error.code), null);
    }
    fileDeltas.forEach(function(fileDelta) {
      /**
       * Delta event.
       *
       * @event DiffList#delta
       *
       * @param {GitError|null} error An error object if there was an issue, null otherwise.
       * @param {FileDelta} fileDelta The file delta object.
       */
      event.emit('delta', null, fileDelta);
      allFileDeltas.push(fileDelta);
    });
  }, function hunkCallback(error, diffHunk) {
    /** TO BE IMPLEMENTED */
  }, function lineCallback(error, diffLine) {
    /** TO BE IMPLEMENTED */
  }, function endCallback(error) {
    /**
     * End event.
     *
     * @event DiffList#end
     *
     * @param {GitError|null} error An error object if there was an issue, null otherwise.
     * @param {FileDelta[]} fileDeltas The file delta objects.
     */
    event.emit('end', error ? new git.error(error.message, error.code) : null, allFileDeltas);
  });

  return event;
};

DiffList.prototype.treeToTree = function(oldSha, newSha, callback) {
  var self = this;
  self.rawDiffList.treeToTree(self.rawRepo, oldSha, newSha, function(error, rawDifflist) {
    if (error) {
      callback(new git.error(error.message, error.code), null);
      return;
    }
    self.rawDiffList = rawDifflist;
    callback(null, self);
  });  
};

exports.diffList = DiffList;

/**
 * @namespace
 * @property {Object} oldFile Contains details for the old file state 
 * @property {String} oldFile.path The path to the old file, relative to the repository 
 * @property {Object} newFile Contains details for the new file state
 * @property {String} newFile.path The path to the new file, relative to the repository
 * @property {Object[]} content Array of context & differences 
 * @property {Object} content[].range 
 * @property {Object} content[].range.old
 * @property {Integer} content[].range.old.start
 * @property {Integer} content[].range.old.lines
 * @property {Object} content[].range.new
 * @property {Integer} content[].range.new.start
 * @property {Integer} content[].range.new.lines
 * @property {Object} content[].content Content of the delta
 * @property {DiffList.lineOriginTypes} content[].lineOrigin
 * @property {Integer} content[].contentLength
 * @property {Integer} status Type of delta 
 */
var FileDelta = {
  oldFile: {
    path: String
  },
  newFile: {
    path: String
  },
  content: [
    {
      range: { 
        old: { 
          start: Number, 
          lines: Number 
        }, 
        'new': { 
          start: Number, 
          lines: Number 
        } 
      },
      content: String,
      lineOrigin: String,
      contentLength: Number
    }
  ],
  status: Number
};
</code></pre>
        </article>
    </section>





    </div>
</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Blob.html">Blob</a></li><li><a href="Commit.html">Commit</a></li><li><a href="DiffList.html">DiffList</a></li><li><a href="GitError.html">GitError</a></li><li><a href="Oid.html">Oid</a></li><li><a href="Reference.html">Reference</a></li><li><a href="Repo.html">Repo</a></li><li><a href="RevWalk.html">RevWalk</a></li><li><a href="Tree.html">Tree</a></li><li><a href="TreeEntry.html">TreeEntry</a></li></ul><h3>Events</h3><ul><li><a href="Commit.html#event:commit">commit</a></li><li><a href="Commit.html#event:end">end</a></li><li><a href="DiffList.html#event:delta">delta</a></li><li><a href="DiffList.html#event:end">end</a></li><li><a href="Tree.html#event:end">end</a></li><li><a href="Tree.html#event:entry">entry</a></li></ul><h3>Namespaces</h3><ul><li><a href="FileDelta.html">FileDelta</a></li><li><a href="utilities.html">utilities</a></li></ul><h3>Global</h3><ul><li><a href="global.html#repo">repo</a></li></ul>
</nav>

<br clear="both">

<footer>
    <div class="built-in">
      <a target="_blank" href="http://bostonbuilt.org"><img class="boston" src="img/boston.gif" alt="Built in Boston USA"></a>
      <span class="amp">&amp;</span>
      <img class="nz" src="img/nz.png" alt="Built NZ" />
    </div>
</footer>

<script src="scripts/highlight.pack.js"></script>
<script>
  hljs.tabReplace = '    ';
  hljs.initHighlightingOnLoad();
</script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39991515-2', 'github.io');
  ga('send', 'pageview');

</script>
</body>
</html>

<!--
  ____ ____ ____ ____ ____ ____ ____
  ||N |||O |||D |||E |||. |||J |||S ||
  ||__|||__|||__|||__|||__|||__|||__||
  |/__\|/__\|/__\|/__\|/__\|/__\|/__\|

   ____
  ||+ ||
  ||__||
  |/__\|

   ____ ____ ____ ____ ____ ____ ____
  ||L |||I |||B |||G |||I |||T |||2 ||
  ||__|||__|||__|||__|||__|||__|||__||
  |/__\|/__\|/__\|/__\|/__\|/__\|/__\|

   ____
  ||= ||
  ||__||
  |/__\|

   ____ ____ ____ ____ ____ ____ ____
  ||O |||W |||N |||Z |||O |||N |||E ||
  ||__|||__|||__|||__|||__|||__|||__||
  |/__\|/__\|/__\|/__\|/__\|/__\|/__\|

-->
