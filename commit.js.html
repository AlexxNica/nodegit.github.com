<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Nodegit: Source: commit.js</title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/common.css">
    <link type="text/css" rel="stylesheet" href="styles/ir_black.css">
</head>

<body>

<div id="main">
    <!-- Fork Me -->
    <a href="http://github.com/tbranyen/nodegit">
      <img class="forkme"
      src="http://s3.amazonaws.com/github/ribbons/forkme_left_gray_6d6d6d.png"
      alt="Fork me on GitHub">
    </a>

    <div id="container">

        <!-- Branding -->
        <section class="branding">
            <a class="download" href="http://github.com/tbranyen/nodegit/zipball/master">
                <img src="http://github.com/images/modules/download/zip.png">
            </a>
            <a class="download" href="http://github.com/tbranyen/nodegit/tarball/master">
                <img src="http://github.com/images/modules/download/tar.png">
            </a>
            <div class="headline">
                <a href="http://github.com/tbranyen/nodegit">nodegit</a>
                <a class="travis" href="https://travis-ci.org/tbranyen/nodegit"><img src="https://travis-ci.org/tbranyen/nodegit.png" alt="Build Status" style="max-width:100%;"></a>
            </div>
            <span class="small">by <a href="http://github.com/tbranyen">tbranyen</a> &amp; <a href="http://github.com/faceleg">faceleg</a></span>
        </section>
        <div class="social">
            <iframe src="http://ghbtns.com/github-btn.html?count=true&user=tbranyen&repo=nodegit&type=watch" allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://nodegit.github.com/" data-text="When I need git tools in Node.js, I use nodegit" data-hashtags="nodejs">Tweet</a>
        </div>

        


    
    <section>
        <article>
            <pre><code>var git = require( '../' ),
  success = require('./utilities').success,
  events = require('events');

/**
 * Convenience commit constructor.
 *
 * @constructor
 * @param {git.raw.Repo} rawRepo Raw repository object.
 * @param  {git.raw.Commit} [rawCommit = new git.raw.Commit(rawRepo)] Raw commit object.
 */
var Commit = function(rawRepo, rawCommit) {
  if (!(rawRepo instanceof git.raw.Repo)) {
    throw new git.error('First parameter for Commit must be a raw repo');
  }

  this.rawRepo = rawRepo;

  if (rawCommit instanceof git.raw.Commit) {
    this.rawCommit = rawCommit;
  } else {
    this.rawCommit = new git.raw.Commit();
  }
};

/**
 * Look up the commit referenced by oid, replace this.commit with the result.
 *
 * @param {Oid|git.raw.Oid|String} oid A representation of an OID used to lookup the commit.
 * @param {Commit~lookupCallback} callback
 */
Commit.prototype.lookup = function(oid, callback) {
  /**
   * @callback Commit~lookupCallback Callback executed on lookup completion.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Commit|null} commit Retrieved commit object or null.
   */
  if (typeof oid !== 'undefined' &&
      typeof oid !== 'string' &&
      !(oid instanceof git.raw.Oid)) {
    oid = oid.getRawOid();
  }
  var self = this;
  self.rawCommit.lookup(self.rawRepo, oid, function commitLookup(error, rawCommit) {
    if (success(error, callback)) {
      self.rawCommit = rawCommit;
      callback(null, self);
    }
  });
};

/**
 * Retrieve the commit's OID.
 *
 * @param {Commit~oidCallback} callback
 */
Commit.prototype.oid = function(callback) {
  /**
   * @callback Commit~oidCallback Callback executed on OID retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Oid|null} commit Retrieved OID object or null.
   */
  callback(null, new git.oid(this.rawCommit.oid()));
};

/**
 * Retrieve the SHA.
 *
 * @param {Commit~shaCallback} callback
 */
Commit.prototype.sha = function(callback) {
  /**
   * @callback Commit~shaCallback Callback executed on SHA retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {String|null} sha Retrieved SHA.
   */
  this.oid(function(error, oid) {
    if (!success(error, callback)) {
      return;
    }
    oid.sha(function(error, sha) {
      if (!success(error, callback)) {
        return;
      }
      callback(null, sha);
    });
  });
};

/**
 * Retrieve the message
 *
 * @param {Commit~messageCallback} callback
 */
Commit.prototype.message = function(callback) {
  /**
   * @callback Commit~messageCallback Callback executed on message retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {String|null} message Retrieved message.
   */
  this.rawCommit.message(function(error, message) {
    if (success(error, callback)) {
      callback(null, message);
    }
  });
};

/**
 * Retrieve the commit time as a unix timestamp.
 *
 * @param {Commit~timeCallback} callback
 */
Commit.prototype.time = function(callback) {
  /**
   * @callback Commit~timeCallback Callback executed on time retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Integer|null} time Retrieved time in seconds.
   */
  this.rawCommit.time(function(error, time) {
    if (success(error, callback)) {
      // git_commit_time returns timestamp in s, converting to ms here
      callback(null, time * 1000);
    }
  });
};

/**
 * Retrieve the commit time as a Date object.
 *
 * @param {Commit~dateCallback} callback
 */
Commit.prototype.date = function(callback) {
  /**
   * @callback Commit~dateCallback Callback executed on date retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Date|null} time Retrieved time as a Date object.
   */
  this.time(function(error, time) {
    if (success(error, callback)) {
      callback(null, new Date(time));
    }
  });
};

/**
 * Retrieve the commit's positive or negative timezone offset, in minutes from UTC.
 *
 * @param {Commit~offsetCallback} callback
 */
Commit.prototype.offset = function(callback) {
  /**
   * @callback Commit~offsetCallback Callback executed on offset retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Integer|null} offset Retrieved offset in in minutes from UTC.
   */
  this.rawCommit.offset(function(error, offset) {
    if (success(error, callback)) {
      callback(null, offset);
    }
  });
};

/**
 * Retrieve the commit's author signature.
 *
 * @param {Commit~authorCallback} callback
 */
Commit.prototype.author = function(callback) {
  /**
   * @callback Commit~authorCallback Callback executed on author retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Signature|null} author Retrieved author signature.
   */
  this.rawCommit.author(function(error, rawSignature) {
    if (success(error, callback)) {
      callback(null, new git.signature(rawSignature));
    }
  });
};

/**
 * Retrieve the commit's committer.
 *
 * @param {Commit~committerCallback} callback
 */
Commit.prototype.committer = function(callback) {
  /**
   * @callback Commit~committerCallback Callback executed on committer retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Signature|null} committer Retrieved committer signature.
   */
  this.rawCommit.committer(function(error, rawSignature) {
    if (success(error, callback)) {
      callback(null, new git.signature(rawSignature));
    }
  });
};

/**
 * Retrieve the tree for this commit.
 *
 * @param {Commit~treeCallback} callback
 */
Commit.prototype.tree = function(callback) {
  /**
   * @callback Commit~treeCallback Callback executed on tree retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Tree|null} tree Retrieved tree.
   */
  var self = this;
  self.rawCommit.tree(function commitTree(error, rawTree) {
    if (success(error, callback)) {
      callback(null, new git.tree(self.rawRepo, rawTree));
    }
  });
};

/**
 * Retrieve the file represented by path for this commit.
 * Path must be relative to repository root.
 *
 * @param {String} path
 * @param {Commit~fileCallback} callback
 */
Commit.prototype.file = function(path, callback) {
  /**
   * @callback Commit~fileCallback Callback executed on file retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Entry|null} file Retrieved file entry.
   */
  this.tree(function commitFileCallback(error, tree) {
    if (!success(error, callback)) {
      return;
    }
    tree.entry(path, function(error, entry) {
      if (success(error, callback)) {
        callback(null, entry);
      }
    });
  });
};

/**
 * Walk the history from this commit backwards.
 * An EventEmitter is returned that will emit a 'commit' event for each 
 * commit in the history, and one 'end' event when the walk is completed.
 *
 * @fires Commit#commit
 * @fires Commit#end
 *
 * @return {EventEmitter} historyWalkEmitter
 */
Commit.prototype.history = function() {
  var event = new events.EventEmitter(),
      self = this;

  self.oid(function commitOid(error, oid) {
    (new git.revwalk(self.rawRepo)).allocate(function createRevwalk(error, revwalk) {
      var commits = [];
      revwalk.walk(oid, function commitRevWalk(error, index, commit, noMoreCommits) {
        if(error) {
          event.emit('end', error, commits);
          return false;
        }

        if (noMoreCommits) {
          /**
           * End event.
           *
           * @event Commit#end
           *
           * @param {GitError|null} error An error object if there was an issue, null otherwise.
           * @param {Commit[]} commits The commits.
           */
          event.emit('end', null, commits);
          return;
        }
        /**
         * Commit event.
         *
         * @event Commit#commit
         *
         * @param {GitError|null} error An error object if there was an issue, null otherwise.
         * @param {Commit} commit The commit.
         */
        event.emit('commit', null, commit);
        commits.push(commit);
      });
    });
  });

  return event;
};

/**
 * Retrieve the commit's parents.
 *
 * @param {Commit~parentsCallback} callback
 */
Commit.prototype.parents = function(callback) {
  /**
   * @callback Commit~parentsCallback Callback executed on parents retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {Commit[]|null} parents Commit's parent(s).
   */
  var self = this;
  self.rawCommit.parents(function processParent(error, rawParents) {
    if (success(error, callback)) {
      var parents = [];
      rawParents.forEach(function eachParent(rawParent) {
        parents.push(new Commit(self.rawRepo, rawParent));
      });
      callback(null, parents);
    }
  });
};

/**
 * Generate an array of diff trees showing changes between this commit 
 * and its parent(s).
 *
 * @param {Commit~parentsDiffTreesCallback} callback
 */
Commit.prototype.parentsDiffTrees = function(callback) {
  /**
   * @callback Commit~parentsDiffTreesCallback Callback executed on diff trees retrieval.
   * @param {GitError|null} error An Error or null if successful.
   * @param {DiffList[]|null} diffLists Array of DiffTrees showing changes between this commit and its parent(s)
   */
  var self = this;
  self.sha(function(error, commitSha) {
    if (!success(error, callback)) {
      return;
    }
    self.parents(function commitParents(error, parents) {
      if (!success(error, callback)) {
        return;
      }
      var parentDiffLists = [];
      parents.forEach(function commitEachParent(parent) {
        parent.sha(function commitParentSha(error, parentSha) {
          (new git.diffList(self.rawRepo)).treeToTree(parentSha, commitSha, function walkDiffList(error, diffList) {
            if (!success(error, callback)) {
              return;
            }
            parentDiffLists.push(diffList);
            if (parentDiffLists.length === parents.length) {
              callback(null, parentDiffLists);
            }
          });
        });
      });
    });
  });
};

exports.commit = Commit;
</code></pre>
        </article>
    </section>





    </div>
</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Blob.html">Blob</a></li><li><a href="Commit.html">Commit</a></li><li><a href="DiffList.html">DiffList</a></li><li><a href="GitError.html">GitError</a></li><li><a href="Oid.html">Oid</a></li><li><a href="Reference.html">Reference</a></li><li><a href="Repo.html">Repo</a></li><li><a href="RevWalk.html">RevWalk</a></li><li><a href="Tree.html">Tree</a></li><li><a href="TreeEntry.html">TreeEntry</a></li></ul><h3>Events</h3><ul><li><a href="Commit.html#event:commit">commit</a></li><li><a href="Commit.html#event:end">end</a></li><li><a href="DiffList.html#event:delta">delta</a></li><li><a href="DiffList.html#event:end">end</a></li><li><a href="Tree.html#event:end">end</a></li><li><a href="Tree.html#event:entry">entry</a></li></ul><h3>Namespaces</h3><ul><li><a href="FileDelta.html">FileDelta</a></li><li><a href="utilities.html">utilities</a></li></ul><h3>Global</h3><ul><li><a href="global.html#repo">repo</a></li></ul>
</nav>

<br clear="both">

<footer>
    <div class="built-in">
      <a target="_blank" href="http://bostonbuilt.org"><img class="boston" src="img/boston.gif" alt="Built in Boston USA"></a>
      <span class="amp">&amp;</span>
      <img class="nz" src="img/nz.png" alt="Built NZ" />
    </div>
</footer>

<script src="scripts/highlight.pack.js"></script>
<script>
  hljs.tabReplace = '    ';
  hljs.initHighlightingOnLoad();
</script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39991515-2', 'github.io');
  ga('send', 'pageview');

</script>
</body>
</html>

<!--
  ____ ____ ____ ____ ____ ____ ____
  ||N |||O |||D |||E |||. |||J |||S ||
  ||__|||__|||__|||__|||__|||__|||__||
  |/__\|/__\|/__\|/__\|/__\|/__\|/__\|

   ____
  ||+ ||
  ||__||
  |/__\|

   ____ ____ ____ ____ ____ ____ ____
  ||L |||I |||B |||G |||I |||T |||2 ||
  ||__|||__|||__|||__|||__|||__|||__||
  |/__\|/__\|/__\|/__\|/__\|/__\|/__\|

   ____
  ||= ||
  ||__||
  |/__\|

   ____ ____ ____ ____ ____ ____ ____
  ||O |||W |||N |||Z |||O |||N |||E ||
  ||__|||__|||__|||__|||__|||__|||__||
  |/__\|/__\|/__\|/__\|/__\|/__\|/__\|

-->
